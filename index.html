<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ… Santa Tracker - En Vivo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Quicksand', sans-serif; background: #0a0a1a; min-height: 100vh; }
        .header { background: linear-gradient(90deg, #c41e3a, #228b22); padding: 12px; text-align: center; position: relative; z-index: 1000; }
        .header h1 { font-family: 'Mountains of Christmas', cursive; color: white; font-size: 1.5rem; cursor: pointer; }
        .header .live-badge { background: #ff0000; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; animation: pulse 1s infinite; margin-left: 8px; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        #map { width: 100%; height: calc(100vh - 180px); }
        .info-panel { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(10, 10, 26, 0.95); padding: 12px; border-top: 2px solid #ffd700; z-index: 1000; }
        .location-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .location-row .flag { font-size: 2rem; }
        .location-row .country { color: #ffd700; font-family: 'Mountains of Christmas', cursive; font-size: 1.3rem; }
        .location-row .city { color: #87ceeb; font-size: 0.85rem; }
        .countdown { text-align: center; margin: 8px 0; }
        .countdown .time { font-size: 1.8rem; color: #ffd700; font-family: 'Mountains of Christmas', cursive; }
        .countdown .label { color: #87ceeb; font-size: 0.8rem; }
        .progress-bar { width: 100%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #ff6b6b, #ffd700, #4ecdc4); transition: width 1s; }
        .snowflakes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; overflow: hidden; }
        .snowflake { position: absolute; color: white; animation: fall linear infinite; opacity: 0.7; }
        @keyframes fall { 0% { transform: translateY(-10vh) rotate(0deg); } 100% { transform: translateY(110vh) rotate(360deg); } }
        .celebration { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 2000; flex-direction: column; }
        .celebration.active { display: flex; }
        .celebration .santa { font-size: 6rem; animation: bounce 0.5s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .celebration .text { font-family: 'Mountains of Christmas', cursive; color: #ffd700; font-size: 2rem; margin: 15px 0; }
        .celebration .address { color: #87ceeb; font-size: 1rem; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 10px; }
        .confetti { position: absolute; width: 8px; height: 8px; animation: confetti-fall 3s linear infinite; }
        @keyframes confetti-fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .config-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 3000; }
        .config-modal.active { display: flex; }
        .config-box { background: #1a1a2e; padding: 25px; border-radius: 15px; border: 2px solid #ffd700; text-align: center; max-width: 90%; }
        .config-box h2 { font-family: 'Mountains of Christmas', cursive; color: #ffd700; margin-bottom: 15px; }
        .config-box input { width: 100%; padding: 12px; font-size: 1.2rem; border-radius: 8px; border: none; margin: 8px 0; text-align: center; }
        .config-box button { background: linear-gradient(90deg, #c41e3a, #228b22); color: white; border: none; padding: 12px 30px; font-size: 1rem; border-radius: 8px; margin: 8px 5px; cursor: pointer; }
        .config-box .hint { color: #87ceeb; font-size: 0.8rem; margin-top: 10px; }
        .leaflet-popup-content-wrapper { background: #1a1a2e; color: white; border-radius: 10px; border: 2px solid #ffd700; }
        .leaflet-popup-tip { background: #1a1a2e; }
    </style>
</head>
<body>
    <div class="snowflakes" id="snow"></div>
    <div class="header">
        <h1 id="title">ğŸ„ Santa Tracker ğŸ„<span class="live-badge">EN VIVO</span></h1>
    </div>
    <div id="map"></div>
    <div class="info-panel">
        <div class="location-row">
            <span class="flag" id="flag">ğŸ”ï¸</span>
            <div>
                <div class="country" id="country">Polo Norte</div>
                <div class="city" id="city">Preparando el trineo...</div>
            </div>
        </div>
        <div class="countdown">
            <div class="time" id="countdown">--:--:--</div>
            <div class="label" id="countdownLabel">Para llegar a tu casa</div>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progress" style="width:0%"></div></div>
    </div>
    <div class="celebration" id="celebration">
        <div class="santa">ğŸ…</div>
        <div class="text">Â¡PAPÃ NOEL LLEGÃ“!</div>
        <div class="address">ğŸ“ RoldÃ¡n 234 - Resistencia, Chaco<br>ğŸ  Â¡Feliz Navidad!</div>
        <div style="margin-top:20px;font-size:2.5rem;">ğŸ„ğŸğŸ¦ŒğŸ›·ğŸ„</div>
    </div>
    <div class="config-modal" id="configModal">
        <div class="config-box">
            <h2>ğŸ… Configurar Llegada</h2>
            <p style="color:white;margin-bottom:15px;">Â¿A quÃ© hora llega Santa a tu casa?</p>
            <input type="time" id="arrivalTime" value="00:00">
            <input type="date" id="arrivalDate" value="2025-12-25">
            <br>
            <button onclick="saveConfig()">âœ“ Guardar</button>
            <button onclick="closeConfig()" style="background:#666;">âœ• Cancelar</button>
            <div class="hint">TocÃ¡ 3 veces el tÃ­tulo para abrir esta configuraciÃ³n</div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // === CONFIGURACIÃ“N ===
        const DESTINO = { lat: -27.458241856223577, lng: -58.99881432883506, nombre: "RoldÃ¡n 234, Resistencia" };
        
        // Hora de llegada (se puede cambiar con el botÃ³n secreto)
        let HORA_LLEGADA = localStorage.getItem('santaArrival') || '2025-12-25T00:00:00';
        
        // Ruta de Santa - Viaje de 24 horas por el mundo
        const RUTA = [
            { lat: 90, lng: 0, nombre: "Polo Norte", ciudad: "Taller de Santa", flag: "ğŸ”ï¸", hora: 0 },
            { lat: 35.6762, lng: 139.6503, nombre: "JapÃ³n", ciudad: "Tokio", flag: "ğŸ‡¯ğŸ‡µ", hora: 2 },
            { lat: -33.8688, lng: 151.2093, nombre: "Australia", ciudad: "SÃ­dney", flag: "ğŸ‡¦ğŸ‡º", hora: 5 },
            { lat: 28.6139, lng: 77.2090, nombre: "India", ciudad: "Nueva Delhi", flag: "ğŸ‡®ğŸ‡³", hora: 8 },
            { lat: 55.7558, lng: 37.6173, nombre: "Rusia", ciudad: "MoscÃº", flag: "ğŸ‡·ğŸ‡º", hora: 10 },
            { lat: 48.8566, lng: 2.3522, nombre: "Francia", ciudad: "ParÃ­s", flag: "ğŸ‡«ğŸ‡·", hora: 13 },
            { lat: 51.5074, lng: -0.1278, nombre: "Reino Unido", ciudad: "Londres", flag: "ğŸ‡¬ğŸ‡§", hora: 14 },
            { lat: 40.4168, lng: -3.7038, nombre: "EspaÃ±a", ciudad: "Madrid", flag: "ğŸ‡ªğŸ‡¸", hora: 16 },
            { lat: 40.7128, lng: -74.0060, nombre: "Estados Unidos", ciudad: "Nueva York", flag: "ğŸ‡ºğŸ‡¸", hora: 18 },
            { lat: 19.4326, lng: -99.1332, nombre: "MÃ©xico", ciudad: "Ciudad de MÃ©xico", flag: "ğŸ‡²ğŸ‡½", hora: 20 },
            { lat: -22.9068, lng: -43.1729, nombre: "Brasil", ciudad: "RÃ­o de Janeiro", flag: "ğŸ‡§ğŸ‡·", hora: 22 },
            { lat: -34.6037, lng: -58.3816, nombre: "Argentina", ciudad: "Buenos Aires", flag: "ğŸ‡¦ğŸ‡·", hora: 23 },
            { lat: DESTINO.lat, lng: DESTINO.lng, nombre: "Â¡TU CASA!", ciudad: "Resistencia, Chaco", flag: "ğŸ ", hora: 24 }
        ];

        let map, santaMarker, tapCount = 0, tapTimer;

        // Crear nieve
        for(let i = 0; i < 40; i++) {
            const s = document.createElement('div');
            s.className = 'snowflake';
            s.innerHTML = ['â„','â…','â†'][Math.floor(Math.random()*3)];
            s.style.left = Math.random()*100+'vw';
            s.style.animationDuration = (Math.random()*3+3)+'s';
            s.style.animationDelay = Math.random()*5+'s';
            s.style.fontSize = (Math.random()*12+8)+'px';
            document.getElementById('snow').appendChild(s);
        }

        // Triple tap para config
        document.getElementById('title').addEventListener('click', () => {
            tapCount++;
            clearTimeout(tapTimer);
            tapTimer = setTimeout(() => tapCount = 0, 500);
            if(tapCount >= 3) {
                tapCount = 0;
                document.getElementById('configModal').classList.add('active');
                const arrival = new Date(HORA_LLEGADA);
                document.getElementById('arrivalTime').value = arrival.toTimeString().slice(0,5);
                document.getElementById('arrivalDate').value = arrival.toISOString().slice(0,10);
            }
        });

        function saveConfig() {
            const time = document.getElementById('arrivalTime').value;
            const date = document.getElementById('arrivalDate').value;
            HORA_LLEGADA = `${date}T${time}:00`;
            localStorage.setItem('santaArrival', HORA_LLEGADA);
            document.getElementById('configModal').classList.remove('active');
            updateSanta();
        }

        function closeConfig() {
            document.getElementById('configModal').classList.remove('active');
        }

        // Inicializar mapa - OpenStreetMap con mejor detalle al hacer zoom
        map = L.map('map', { zoomControl: true, attributionControl: false }).setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

        // Marcador casa
        L.marker([DESTINO.lat, DESTINO.lng], {
            icon: L.divIcon({ className: '', html: '<div style="font-size:1.8rem">ğŸ </div>', iconSize: [30,30], iconAnchor: [15,30] })
        }).addTo(map).bindPopup('<div style="text-align:center;padding:5px"><b style="color:#ffd700">ğŸ  Tu Casa</b><br><span style="color:#87ceeb">'+DESTINO.nombre+'</span></div>');

        // Marcador Santa - Trineo completo con renos, Santa y bolsa de regalos
        santaMarker = L.marker([90, 0], {
            icon: L.divIcon({ 
                className: '', 
                html: '<div style="font-size:1.2rem;filter:drop-shadow(2px 2px 4px black);white-space:nowrap;background:rgba(0,0,0,0.5);padding:3px 6px;border-radius:8px;border:2px solid gold;">ğŸ¦ŒğŸ¦ŒğŸ›·ğŸ…ğŸ</div>', 
                iconSize: [90,35], 
                iconAnchor: [45,17] 
            }),
            zIndexOffset: 1000
        }).addTo(map);

        // Marcadores de paradas (sin lÃ­nea de recorrido)
        RUTA.forEach((r, i) => {
            if(i > 0 && i < RUTA.length - 1) {
                L.marker([r.lat, r.lng], {
                    icon: L.divIcon({ className: '', html: `<div style="font-size:1.2rem">${r.flag}</div>`, iconSize: [20,20], iconAnchor: [10,10] })
                }).addTo(map).bindPopup(`<div style="text-align:center"><b style="color:#ffd700">${r.flag} ${r.nombre}</b><br><span style="color:#87ceeb">${r.ciudad}</span></div>`);
            }
        });

        let lastZoomTime = 0;
        let hasArrived = false;
        
        function updateSanta() {
            const now = new Date();
            const arrival = new Date(HORA_LLEGADA);
            const totalDuration = 24 * 60 * 60 * 1000; // 24 horas
            const startTime = new Date(arrival.getTime() - totalDuration);
            
            const elapsed = now.getTime() - startTime.getTime();
            const progress = Math.max(0, Math.min(1, elapsed / totalDuration));
            
            // Calcular posiciÃ³n
            const totalStops = RUTA.length - 1;
            const exactStop = progress * totalStops;
            const currentIdx = Math.min(Math.floor(exactStop), totalStops - 1);
            const stopProgress = exactStop - currentIdx;
            
            const from = RUTA[currentIdx];
            const to = RUTA[Math.min(currentIdx + 1, totalStops)];
            
            const lat = from.lat + (to.lat - from.lat) * stopProgress;
            const lng = from.lng + (to.lng - from.lng) * stopProgress;
            
            santaMarker.setLatLng([lat, lng]);
            
            // Actualizar UI
            document.getElementById('flag').textContent = from.flag;
            document.getElementById('country').textContent = from.nombre;
            document.getElementById('city').textContent = from.ciudad;
            document.getElementById('progress').style.width = (progress * 100) + '%';
            
            // Countdown
            const remaining = arrival.getTime() - now.getTime();
            if(remaining > 0) {
                const h = Math.floor(remaining / 3600000);
                const m = Math.floor((remaining % 3600000) / 60000);
                const s = Math.floor((remaining % 60000) / 1000);
                document.getElementById('countdown').textContent = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                document.getElementById('countdownLabel').textContent = 'Para llegar a tu casa';
                
                // === ZOOM INTELIGENTE ===
                const hoursRemaining = remaining / 3600000;
                const nowTime = Date.now();
                
                // Solo actualizar zoom cada 30 segundos
                if(nowTime - lastZoomTime > 30000) {
                    lastZoomTime = nowTime;
                    
                    if(hoursRemaining <= 1) {
                        // Ãšltima hora: Mostrar Santa y casa juntos con zoom alto
                        const bounds = L.latLngBounds([[lat, lng], [DESTINO.lat, DESTINO.lng]]);
                        map.flyToBounds(bounds.pad(0.3), { duration: 2, maxZoom: 10 });
                    } else if(hoursRemaining <= 3) {
                        // Ãšltimas 3 horas: Mostrar ambos con zoom medio
                        const bounds = L.latLngBounds([[lat, lng], [DESTINO.lat, DESTINO.lng]]);
                        map.flyToBounds(bounds.pad(0.5), { duration: 2, maxZoom: 6 });
                    } else if(hoursRemaining <= 6) {
                        // Ãšltimas 6 horas: Vista de SudamÃ©rica
                        const bounds = L.latLngBounds([[lat, lng], [DESTINO.lat, DESTINO.lng]]);
                        map.flyToBounds(bounds.pad(0.8), { duration: 2, maxZoom: 4 });
                    } else {
                        // MÃ¡s de 6 horas: Vista mundial centrada en Santa
                        map.flyTo([lat, lng], 3, { duration: 2 });
                    }
                }
                
            } else {
                // Â¡LlegÃ³!
                if(!hasArrived) {
                    hasArrived = true;
                    document.getElementById('countdown').textContent = 'Â¡LLEGÃ“!';
                    document.getElementById('countdownLabel').textContent = 'ğŸ… PapÃ¡ Noel estÃ¡ en tu casa';
                    santaMarker.setLatLng([DESTINO.lat, DESTINO.lng]);
                    
                    // Zoom dramÃ¡tico hacia la casa
                    map.flyTo([DESTINO.lat, DESTINO.lng], 8, { duration: 2 });
                    setTimeout(() => map.flyTo([DESTINO.lat, DESTINO.lng], 12, { duration: 2 }), 2500);
                    setTimeout(() => map.flyTo([DESTINO.lat, DESTINO.lng], 16, { duration: 2 }), 5000);
                    
                    setTimeout(() => {
                        const cel = document.getElementById('celebration');
                        cel.classList.add('active');
                        // Confeti
                        const colors = ['#ff6b6b','#ffd700','#4ecdc4','#ff9ff3','#54a0ff'];
                        for(let i = 0; i < 80; i++) {
                            const c = document.createElement('div');
                            c.className = 'confetti';
                            c.style.left = Math.random()*100+'vw';
                            c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                            c.style.animationDelay = Math.random()*3+'s';
                            cel.appendChild(c);
                        }
                    }, 6000);
                }
                return;
            }
        }

        // Actualizar cada segundo
        updateSanta();
        setInterval(updateSanta, 1000);
    </script>
</body>
</html>
