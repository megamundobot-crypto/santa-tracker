<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ… Santa Tracker - En Vivo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Quicksand', sans-serif; background: #0a0a1a; min-height: 100vh; }
        .header { background: linear-gradient(90deg, #c41e3a, #228b22); padding: 12px; text-align: center; position: relative; z-index: 1000; }
        .header h1 { font-family: 'Mountains of Christmas', cursive; color: white; font-size: 1.5rem; cursor: pointer; }
        .header .live-badge { background: #ff0000; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; animation: pulse 1s infinite; margin-left: 8px; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        #map { width: 100%; height: calc(100vh - 180px); }
        .info-panel { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(10, 10, 26, 0.95); padding: 12px; border-top: 2px solid #ffd700; z-index: 1000; }
        .location-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .location-row .flag { font-size: 2rem; }
        .location-row .country { color: #ffd700; font-family: 'Mountains of Christmas', cursive; font-size: 1.3rem; }
        .location-row .city { color: #87ceeb; font-size: 0.85rem; }
        .countdown { text-align: center; margin: 8px 0; }
        .countdown .time { font-size: 1.8rem; color: #ffd700; font-family: 'Mountains of Christmas', cursive; }
        .countdown .label { color: #87ceeb; font-size: 0.8rem; }
        .progress-bar { width: 100%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #ff6b6b, #ffd700, #4ecdc4); transition: width 1s; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,215,0,0.3); }
        .stat-item { text-align: center; }
        .stat-item .icon { font-size: 1.2rem; }
        .stat-item .value { color: #ffd700; font-size: 0.9rem; font-weight: bold; }
        .stat-item .label { color: #87ceeb; font-size: 0.55rem; text-transform: uppercase; }
        .snowflakes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; overflow: hidden; }
        .snowflake { position: absolute; color: white; animation: fall linear infinite; opacity: 0.7; }
        @keyframes fall { 0% { transform: translateY(-10vh) rotate(0deg); } 100% { transform: translateY(110vh) rotate(360deg); } }
        .celebration { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 2000; flex-direction: column; }
        .celebration.active { display: flex; }
        .celebration .santa { font-size: 6rem; animation: bounce 0.5s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .celebration .text { font-family: 'Mountains of Christmas', cursive; color: #ffd700; font-size: 2rem; margin: 15px 0; text-align: center; }
        .celebration .address { color: #87ceeb; font-size: 1rem; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 10px; text-align: center; }
        .celebration .close-btn { margin-top: 20px; background: #c41e3a; color: white; border: none; padding: 10px 25px; border-radius: 8px; cursor: pointer; font-size: 1rem; }
        .confetti { position: absolute; width: 8px; height: 8px; animation: confetti-fall 3s linear infinite; }
        @keyframes confetti-fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .config-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 3000; overflow-y: auto; }
        .config-modal.active { display: flex; }
        .config-box { background: #1a1a2e; padding: 20px; border-radius: 15px; border: 2px solid #ffd700; text-align: center; max-width: 95%; margin: 20px; }
        .config-box h2 { font-family: 'Mountains of Christmas', cursive; color: #ffd700; margin-bottom: 15px; font-size: 1.3rem; }
        .config-box h3 { color: #4ecdc4; font-size: 1rem; margin: 15px 0 8px 0; }
        .config-box input { width: 100%; padding: 10px; font-size: 1rem; border-radius: 8px; border: none; margin: 5px 0; text-align: center; }
        .config-box button { background: linear-gradient(90deg, #c41e3a, #228b22); color: white; border: none; padding: 12px 25px; font-size: 1rem; border-radius: 8px; margin: 8px 5px; cursor: pointer; }
        .config-box .hint { color: #87ceeb; font-size: 0.75rem; margin-top: 10px; }
        .leaflet-popup-content-wrapper { background: #1a1a2e; color: white; border-radius: 10px; border: 2px solid #ffd700; }
        .leaflet-popup-tip { background: #1a1a2e; }
        .dest-indicator { position: fixed; top: 60px; right: 10px; background: rgba(0,0,0,0.8); padding: 8px 12px; border-radius: 10px; z-index: 1001; border: 1px solid #ffd700; }
        .dest-indicator span { color: #87ceeb; font-size: 0.8rem; }
        .countdown-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 2500; flex-direction: column; }
        .countdown-overlay.active { display: flex; }
        .countdown-overlay .big-number { font-size: 12rem; font-family: 'Mountains of Christmas', cursive; color: #ffd700; text-shadow: 0 0 30px #ffd700, 0 0 60px #ff6b6b; animation: pulse-number 1s ease-in-out infinite; }
        .countdown-overlay .arriving-text { font-family: 'Mountains of Christmas', cursive; color: #ff6b6b; font-size: 2rem; margin-bottom: 20px; animation: blink 0.5s infinite; }
        .countdown-overlay .house-icon { font-size: 3rem; margin-top: 20px; }
        @keyframes pulse-number { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="snowflakes" id="snow"></div>
    <div class="header">
        <h1 id="title">ğŸ„ Santa Tracker ğŸ„<span class="live-badge">EN VIVO</span></h1>
    </div>
    <div class="dest-indicator">
        <span id="destIndicator">ğŸ  PrÃ³ximo: Casa 1</span>
    </div>
    <div id="map"></div>
    <div class="info-panel">
        <div class="location-row">
            <span class="flag" id="flag">ğŸ”ï¸</span>
            <div>
                <div class="country" id="country">Polo Norte</div>
                <div class="city" id="city">Preparando el trineo...</div>
            </div>
        </div>
        <div class="countdown">
            <div class="time" id="countdown">--:--:--</div>
            <div class="label" id="countdownLabel">Para llegar</div>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progress" style="width:0%"></div></div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="icon">ğŸ“</div>
                <div class="value" id="statDistance">--</div>
                <div class="label">Distancia</div>
            </div>
            <div class="stat-item">
                <div class="icon">âš¡</div>
                <div class="value" id="statSpeed">--</div>
                <div class="label">Velocidad</div>
            </div>
            <div class="stat-item">
                <div class="icon">ğŸ</div>
                <div class="value" id="statGifts">--</div>
                <div class="label">Regalos</div>
            </div>
            <div class="stat-item">
                <div class="icon">ğŸŒ</div>
                <div class="value" id="statCountries">--</div>
                <div class="label">PaÃ­ses</div>
            </div>
        </div>
    </div>
    <div class="celebration" id="celebration1">
        <div class="santa">ğŸ…</div>
        <div class="text" id="celText1">Â¡PAPÃ NOEL LLEGÃ“!</div>
        <div class="address" id="celAddr1">ğŸ“ RoldÃ¡n 234<br>ğŸ  Â¡Feliz Navidad!</div>
        <div style="margin-top:15px;font-size:2rem;">ğŸ„ğŸğŸ¦ŒğŸ›·ğŸ„</div>
        <button class="close-btn" onclick="closeCel1()">Continuar seguimiento â†’</button>
    </div>
    <div class="celebration" id="celebration2">
        <div class="santa">ğŸ…</div>
        <div class="text">Â¡LLEGÃ“ A LA SEGUNDA CASA!</div>
        <div class="address">ğŸ“ Casa de tu Hermana<br>ğŸ  Â¡Feliz Navidad!</div>
        <div style="margin-top:15px;font-size:2rem;">ğŸ„ğŸğŸ¦ŒğŸ›·ğŸ„</div>
    </div>
    <div class="countdown-overlay" id="countdownOverlay">
        <div class="arriving-text" id="arrivingText">ğŸ… Â¡SANTA ESTÃ LLEGANDO!</div>
        <div class="big-number" id="bigCountdown">10</div>
        <div class="house-icon" id="houseIcon">ğŸ </div>
    </div>
    <div class="config-modal" id="configModal">
        <div class="config-box">
            <h2>ğŸ… Configurar Llegadas</h2>
            <h3>ğŸ  CASA 1 - Tu Casa (RoldÃ¡n 234)</h3>
            <input type="time" id="arrival1Time" value="00:00">
            <input type="date" id="arrival1Date" value="2025-12-25">
            <h3>ğŸ¡ CASA 2 - Casa de Hermana</h3>
            <input type="time" id="arrival2Time" value="00:30">
            <input type="date" id="arrival2Date" value="2025-12-25">
            <br><br>
            <button onclick="saveConfig()">âœ“ Guardar</button>
            <button onclick="closeConfig()" style="background:#666;">âœ• Cancelar</button>
            <div class="hint">TocÃ¡ 3 veces el tÃ­tulo para abrir esta configuraciÃ³n</div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // === DOS DESTINOS ===
        const CASA1 = { lat: -27.458241856223577, lng: -58.99881432883506, nombre: "RoldÃ¡n 234", label: "Tu Casa" };
        const CASA2 = { lat: -27.465750, lng: -59.004528, nombre: "Casa Hermana", label: "Casa de tu Hermana" };
        
        // Horas de llegada
        let HORA_CASA1 = localStorage.getItem('santaCasa1') || '2025-12-25T00:00:00';
        let HORA_CASA2 = localStorage.getItem('santaCasa2') || '2025-12-25T00:30:00';
        
        // Ruta mundial
        const RUTA_MUNDIAL = [
            { lat: 90, lng: 0, nombre: "Polo Norte", ciudad: "Taller de Santa", flag: "ğŸ”ï¸" },
            { lat: 35.6762, lng: 139.6503, nombre: "JapÃ³n", ciudad: "Tokio", flag: "ğŸ‡¯ğŸ‡µ" },
            { lat: 37.5665, lng: 126.9780, nombre: "Corea del Sur", ciudad: "SeÃºl", flag: "ğŸ‡°ğŸ‡·" },
            { lat: 39.9042, lng: 116.4074, nombre: "China", ciudad: "Beijing", flag: "ğŸ‡¨ğŸ‡³" },
            { lat: 22.3193, lng: 114.1694, nombre: "Hong Kong", ciudad: "Hong Kong", flag: "ğŸ‡­ğŸ‡°" },
            { lat: 13.7563, lng: 100.5018, nombre: "Tailandia", ciudad: "Bangkok", flag: "ğŸ‡¹ğŸ‡­" },
            { lat: 1.3521, lng: 103.8198, nombre: "Singapur", ciudad: "Singapur", flag: "ğŸ‡¸ğŸ‡¬" },
            { lat: -33.8688, lng: 151.2093, nombre: "Australia", ciudad: "SÃ­dney", flag: "ğŸ‡¦ğŸ‡º" },
            { lat: -36.8485, lng: 174.7633, nombre: "Nueva Zelanda", ciudad: "Auckland", flag: "ğŸ‡³ğŸ‡¿" },
            { lat: 28.6139, lng: 77.2090, nombre: "India", ciudad: "Nueva Delhi", flag: "ğŸ‡®ğŸ‡³" },
            { lat: 25.2048, lng: 55.2708, nombre: "Emiratos Ãrabes", ciudad: "Dubai", flag: "ğŸ‡¦ğŸ‡ª" },
            { lat: 31.7683, lng: 35.2137, nombre: "Israel", ciudad: "JerusalÃ©n", flag: "ğŸ‡®ğŸ‡±" },
            { lat: 41.0082, lng: 28.9784, nombre: "TurquÃ­a", ciudad: "Estambul", flag: "ğŸ‡¹ğŸ‡·" },
            { lat: 55.7558, lng: 37.6173, nombre: "Rusia", ciudad: "MoscÃº", flag: "ğŸ‡·ğŸ‡º" },
            { lat: 52.5200, lng: 13.4050, nombre: "Alemania", ciudad: "BerlÃ­n", flag: "ğŸ‡©ğŸ‡ª" },
            { lat: 48.8566, lng: 2.3522, nombre: "Francia", ciudad: "ParÃ­s", flag: "ğŸ‡«ğŸ‡·" },
            { lat: 51.5074, lng: -0.1278, nombre: "Reino Unido", ciudad: "Londres", flag: "ğŸ‡¬ğŸ‡§" },
            { lat: 40.4168, lng: -3.7038, nombre: "EspaÃ±a", ciudad: "Madrid", flag: "ğŸ‡ªğŸ‡¸" },
            { lat: 30.0444, lng: 31.2357, nombre: "Egipto", ciudad: "El Cairo", flag: "ğŸ‡ªğŸ‡¬" },
            { lat: -33.9249, lng: 18.4241, nombre: "SudÃ¡frica", ciudad: "Ciudad del Cabo", flag: "ğŸ‡¿ğŸ‡¦" },
            { lat: 45.4215, lng: -75.6972, nombre: "CanadÃ¡", ciudad: "Ottawa", flag: "ğŸ‡¨ğŸ‡¦" },
            { lat: 40.7128, lng: -74.0060, nombre: "Estados Unidos", ciudad: "Nueva York", flag: "ğŸ‡ºğŸ‡¸" },
            { lat: 19.4326, lng: -99.1332, nombre: "MÃ©xico", ciudad: "Ciudad de MÃ©xico", flag: "ğŸ‡²ğŸ‡½" },
            { lat: 23.1136, lng: -82.3666, nombre: "Cuba", ciudad: "La Habana", flag: "ğŸ‡¨ğŸ‡º" },
            { lat: 4.7110, lng: -74.0721, nombre: "Colombia", ciudad: "BogotÃ¡", flag: "ğŸ‡¨ğŸ‡´" },
            { lat: -12.0464, lng: -77.0428, nombre: "PerÃº", ciudad: "Lima", flag: "ğŸ‡µğŸ‡ª" },
            { lat: -33.4489, lng: -70.6693, nombre: "Chile", ciudad: "Santiago", flag: "ğŸ‡¨ğŸ‡±" },
            { lat: -22.9068, lng: -43.1729, nombre: "Brasil", ciudad: "RÃ­o de Janeiro", flag: "ğŸ‡§ğŸ‡·" },
            { lat: -34.9011, lng: -56.1645, nombre: "Uruguay", ciudad: "Montevideo", flag: "ğŸ‡ºğŸ‡¾" },
            { lat: -25.2637, lng: -57.5759, nombre: "Paraguay", ciudad: "AsunciÃ³n", flag: "ğŸ‡µğŸ‡¾" },
            { lat: -34.6037, lng: -58.3816, nombre: "Argentina", ciudad: "Buenos Aires", flag: "ğŸ‡¦ğŸ‡·" },
            { lat: -31.4201, lng: -64.1888, nombre: "Argentina", ciudad: "CÃ³rdoba", flag: "ğŸ‡¦ğŸ‡·" },
            { lat: CASA1.lat, lng: CASA1.lng, nombre: "Â¡CASA 1!", ciudad: CASA1.nombre, flag: "ğŸ " }
        ];

        let map, santaMarker, tapCount = 0, tapTimer;
        let arrivedCasa1 = false, arrivedCasa2 = false;
        let casa1Marker, casa2Marker;
        let countdownShownCasa1 = false, countdownShownCasa2 = false;

        // Crear nieve
        for(let i = 0; i < 40; i++) {
            const s = document.createElement('div');
            s.className = 'snowflake';
            s.innerHTML = ['â„','â…','â†'][Math.floor(Math.random()*3)];
            s.style.left = Math.random()*100+'vw';
            s.style.animationDuration = (Math.random()*3+3)+'s';
            s.style.animationDelay = Math.random()*5+'s';
            s.style.fontSize = (Math.random()*12+8)+'px';
            document.getElementById('snow').appendChild(s);
        }

        // Triple tap para config
        document.getElementById('title').addEventListener('click', () => {
            tapCount++;
            clearTimeout(tapTimer);
            tapTimer = setTimeout(() => tapCount = 0, 500);
            if(tapCount >= 3) {
                tapCount = 0;
                openConfig();
            }
        });

        function openConfig() {
            document.getElementById('configModal').classList.add('active');
            const a1 = new Date(HORA_CASA1);
            const a2 = new Date(HORA_CASA2);
            document.getElementById('arrival1Time').value = a1.toTimeString().slice(0,5);
            document.getElementById('arrival1Date').value = a1.toISOString().slice(0,10);
            document.getElementById('arrival2Time').value = a2.toTimeString().slice(0,5);
            document.getElementById('arrival2Date').value = a2.toISOString().slice(0,10);
        }

        function saveConfig() {
            const t1 = document.getElementById('arrival1Time').value;
            const d1 = document.getElementById('arrival1Date').value;
            const t2 = document.getElementById('arrival2Time').value;
            const d2 = document.getElementById('arrival2Date').value;
            HORA_CASA1 = `${d1}T${t1}:00`;
            HORA_CASA2 = `${d2}T${t2}:00`;
            localStorage.setItem('santaCasa1', HORA_CASA1);
            localStorage.setItem('santaCasa2', HORA_CASA2);
            document.getElementById('configModal').classList.remove('active');
            arrivedCasa1 = false;
            arrivedCasa2 = false;
            updateSanta();
        }

        function closeConfig() {
            document.getElementById('configModal').classList.remove('active');
        }

        function closeCel1() {
            document.getElementById('celebration1').classList.remove('active');
        }

        // Inicializar mapa
        map = L.map('map', { zoomControl: true, attributionControl: false }).setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

        // Marcadores de las 2 casas
        casa1Marker = L.marker([CASA1.lat, CASA1.lng], {
            icon: L.divIcon({ className: '', html: '<div style="font-size:1.8rem">ğŸ </div>', iconSize: [30,30], iconAnchor: [15,30] })
        }).addTo(map).bindPopup('<div style="text-align:center;padding:5px"><b style="color:#ffd700">ğŸ  '+CASA1.label+'</b><br><span style="color:#87ceeb">'+CASA1.nombre+'</span></div>');

        casa2Marker = L.marker([CASA2.lat, CASA2.lng], {
            icon: L.divIcon({ className: '', html: '<div style="font-size:1.8rem">ğŸ¡</div>', iconSize: [30,30], iconAnchor: [15,30] })
        }).addTo(map).bindPopup('<div style="text-align:center;padding:5px"><b style="color:#4ecdc4">ğŸ¡ '+CASA2.label+'</b><br><span style="color:#87ceeb">'+CASA2.nombre+'</span></div>');

        // Marcador Santa
        santaMarker = L.marker([90, 0], {
            icon: L.divIcon({ 
                className: '', 
                html: '<div style="font-size:1.2rem;filter:drop-shadow(2px 2px 4px black);white-space:nowrap;background:rgba(0,0,0,0.5);padding:3px 6px;border-radius:8px;border:2px solid gold;">ğŸ¦ŒğŸ¦ŒğŸ›·ğŸ…ğŸ</div>', 
                iconSize: [90,35], 
                iconAnchor: [45,17] 
            }),
            zIndexOffset: 1000
        }).addTo(map);

        // Marcadores de paradas
        RUTA_MUNDIAL.forEach((r, i) => {
            if(i > 0 && i < RUTA_MUNDIAL.length - 1) {
                L.marker([r.lat, r.lng], {
                    icon: L.divIcon({ className: '', html: `<div style="font-size:1.2rem">${r.flag}</div>`, iconSize: [20,20], iconAnchor: [10,10] })
                }).addTo(map).bindPopup(`<div style="text-align:center"><b style="color:#ffd700">${r.flag} ${r.nombre}</b><br><span style="color:#87ceeb">${r.ciudad}</span></div>`);
            }
        });

        let lastZoomTime = 0;
        
        // FunciÃ³n para calcular distancia en km
        function haversine(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
        
        // Formatear nÃºmeros grandes
        function formatNum(n) {
            if(n >= 1000000000) return (n/1000000000).toFixed(1) + 'B';
            if(n >= 1000000) return (n/1000000).toFixed(1) + 'M';
            if(n >= 1000) return (n/1000).toFixed(1) + 'K';
            return n.toFixed(0);
        }
        
        function updateSanta() {
            const now = new Date();
            const arrivalCasa1 = new Date(HORA_CASA1);
            const arrivalCasa2 = new Date(HORA_CASA2);
            
            // FASE 1: Recorrido mundial hasta Casa 1
            if(now < arrivalCasa1) {
                document.getElementById('destIndicator').textContent = 'ğŸ  PrÃ³ximo: Casa 1';
                const totalDuration = 24 * 60 * 60 * 1000;
                const startTime = new Date(arrivalCasa1.getTime() - totalDuration);
                const elapsed = now.getTime() - startTime.getTime();
                const progress = Math.max(0, Math.min(1, elapsed / totalDuration));
                
                const totalStops = RUTA_MUNDIAL.length - 1;
                const exactStop = progress * totalStops;
                const currentIdx = Math.min(Math.floor(exactStop), totalStops - 1);
                const stopProgress = exactStop - currentIdx;
                
                const from = RUTA_MUNDIAL[currentIdx];
                const to = RUTA_MUNDIAL[Math.min(currentIdx + 1, totalStops)];
                
                const lat = from.lat + (to.lat - from.lat) * stopProgress;
                const lng = from.lng + (to.lng - from.lng) * stopProgress;
                
                santaMarker.setLatLng([lat, lng]);
                
                document.getElementById('flag').textContent = from.flag;
                document.getElementById('country').textContent = from.nombre;
                document.getElementById('city').textContent = from.ciudad;
                document.getElementById('progress').style.width = (progress * 100) + '%';
                
                const remaining = arrivalCasa1.getTime() - now.getTime();
                const h = Math.floor(remaining / 3600000);
                const m = Math.floor((remaining % 3600000) / 60000);
                const s = Math.floor((remaining % 60000) / 1000);
                document.getElementById('countdown').textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                document.getElementById('countdownLabel').textContent = 'Para llegar a Casa 1';
                
                // Actualizar estadÃ­sticas
                const distToCasa = haversine(lat, lng, CASA1.lat, CASA1.lng);
                const speed = 3000 + Math.random() * 500;
                const totalGifts = 7800000000;
                const giftsDelivered = Math.floor(totalGifts * progress);
                
                document.getElementById('statDistance').textContent = distToCasa.toFixed(0) + ' km';
                document.getElementById('statSpeed').textContent = speed.toFixed(0);
                document.getElementById('statGifts').textContent = formatNum(giftsDelivered);
                document.getElementById('statCountries').textContent = currentIdx + '/' + totalStops;
                
                // CUENTA REGRESIVA 10 SEGUNDOS - Casa 1
                const secondsRemaining = Math.floor(remaining / 1000);
                if(secondsRemaining <= 10 && secondsRemaining > 0 && !countdownShownCasa1) {
                    countdownShownCasa1 = true;
                    document.getElementById('arrivingText').textContent = 'ğŸ… Â¡SANTA LLEGANDO A TU CASA!';
                    document.getElementById('houseIcon').textContent = 'ğŸ ';
                    document.getElementById('countdownOverlay').classList.add('active');
                }
                if(secondsRemaining <= 10 && secondsRemaining > 0) {
                    document.getElementById('bigCountdown').textContent = secondsRemaining;
                }
                if(secondsRemaining <= 0) {
                    document.getElementById('countdownOverlay').classList.remove('active');
                }
                
                // Zoom inteligente
                if(Date.now() - lastZoomTime > 30000) {
                    lastZoomTime = Date.now();
                    const hoursRemaining = remaining / 3600000;
                    if(hoursRemaining <= 1) {
                        const bounds = L.latLngBounds([[lat, lng], [CASA1.lat, CASA1.lng]]);
                        map.flyToBounds(bounds.pad(0.3), { duration: 2, maxZoom: 10 });
                    } else if(hoursRemaining <= 3) {
                        const bounds = L.latLngBounds([[lat, lng], [CASA1.lat, CASA1.lng]]);
                        map.flyToBounds(bounds.pad(0.5), { duration: 2, maxZoom: 6 });
                    } else {
                        map.flyTo([lat, lng], 3, { duration: 2 });
                    }
                }
            }
            // FASE 2: LlegÃ³ a Casa 1, viaja a Casa 2
            else if(now >= arrivalCasa1 && now < arrivalCasa2) {
                if(!arrivedCasa1) {
                    arrivedCasa1 = true;
                    showCelebration(1);
                }
                
                document.getElementById('destIndicator').textContent = 'ğŸ¡ PrÃ³ximo: Casa 2';
                
                const travelTime = arrivalCasa2.getTime() - arrivalCasa1.getTime();
                const elapsed = now.getTime() - arrivalCasa1.getTime();
                const progress = Math.min(1, elapsed / travelTime);
                
                const lat = CASA1.lat + (CASA2.lat - CASA1.lat) * progress;
                const lng = CASA1.lng + (CASA2.lng - CASA1.lng) * progress;
                
                santaMarker.setLatLng([lat, lng]);
                
                document.getElementById('flag').textContent = 'ğŸ¦Œ';
                document.getElementById('country').textContent = 'En camino...';
                document.getElementById('city').textContent = 'Casa 1 â†’ Casa 2';
                document.getElementById('progress').style.width = (progress * 100) + '%';
                
                const remaining = arrivalCasa2.getTime() - now.getTime();
                const m = Math.floor(remaining / 60000);
                const s = Math.floor((remaining % 60000) / 1000);
                document.getElementById('countdown').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                document.getElementById('countdownLabel').textContent = 'Para llegar a Casa 2';
                
                // EstadÃ­sticas FASE 2
                const distToCasa2 = haversine(lat, lng, CASA2.lat, CASA2.lng);
                document.getElementById('statDistance').textContent = (distToCasa2 * 1000).toFixed(0) + ' m';
                document.getElementById('statSpeed').textContent = '50';
                document.getElementById('statGifts').textContent = '7.8B';
                document.getElementById('statCountries').textContent = '32/32';
                
                // CUENTA REGRESIVA 10 SEGUNDOS - Casa 2
                const secondsRemaining2 = Math.floor(remaining / 1000);
                if(secondsRemaining2 <= 10 && secondsRemaining2 > 0 && !countdownShownCasa2) {
                    countdownShownCasa2 = true;
                    document.getElementById('arrivingText').textContent = 'ğŸ… Â¡SANTA LLEGANDO A CASA 2!';
                    document.getElementById('houseIcon').textContent = 'ğŸ¡';
                    document.getElementById('countdownOverlay').classList.add('active');
                }
                if(secondsRemaining2 <= 10 && secondsRemaining2 > 0) {
                    document.getElementById('bigCountdown').textContent = secondsRemaining2;
                }
                if(secondsRemaining2 <= 0) {
                    document.getElementById('countdownOverlay').classList.remove('active');
                }
                
                if(Date.now() - lastZoomTime > 10000) {
                    lastZoomTime = Date.now();
                    const bounds = L.latLngBounds([[CASA1.lat, CASA1.lng], [CASA2.lat, CASA2.lng]]);
                    map.flyToBounds(bounds.pad(0.5), { duration: 2, maxZoom: 15 });
                }
            }
            // FASE 3: LlegÃ³ a Casa 2
            else {
                if(!arrivedCasa2) {
                    arrivedCasa2 = true;
                    santaMarker.setLatLng([CASA2.lat, CASA2.lng]);
                    document.getElementById('celebration1').classList.remove('active');
                    showCelebration(2);
                    map.flyTo([CASA2.lat, CASA2.lng], 17, { duration: 2 });
                }
                
                document.getElementById('destIndicator').textContent = 'âœ… Â¡LlegÃ³ a ambas casas!';
                document.getElementById('flag').textContent = 'ğŸ…';
                document.getElementById('country').textContent = 'Â¡LLEGÃ“!';
                document.getElementById('city').textContent = 'PapÃ¡ Noel completÃ³ su recorrido';
                document.getElementById('countdown').textContent = 'ğŸ„ğŸğŸ„';
                document.getElementById('countdownLabel').textContent = 'Â¡Feliz Navidad!';
                document.getElementById('progress').style.width = '100%';
                
                // EstadÃ­sticas FASE 3
                document.getElementById('statDistance').textContent = '0 m';
                document.getElementById('statSpeed').textContent = '0';
                document.getElementById('statGifts').textContent = '7.8B';
                document.getElementById('statCountries').textContent = 'âœ“ 32';
            }
        }

        function showCelebration(num) {
            const cel = document.getElementById('celebration' + num);
            cel.classList.add('active');
            const colors = ['#ff6b6b','#ffd700','#4ecdc4','#ff9ff3','#54a0ff'];
            for(let i = 0; i < 60; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random()*100+'vw';
                c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                c.style.animationDelay = Math.random()*3+'s';
                cel.appendChild(c);
            }
        }

        updateSanta();
        setInterval(updateSanta, 1000);
    </script>
</body>
</html>
