<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ… Santa Tracker - NORAD Style</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Orbitron', monospace; background: #0a0a1a; min-height: 100vh; overflow-x: hidden; }
        .header { background: linear-gradient(90deg, #1a1a2e, #16213e); padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #00ff00; position: relative; z-index: 1000; }
        .header h1 { font-family: 'Mountains of Christmas', cursive; color: #00ff00; font-size: 1.2rem; text-shadow: 0 0 10px #00ff00; cursor: pointer; }
        .header .live-badge { background: #ff0000; color: white; padding: 3px 10px; border-radius: 3px; font-size: 0.65rem; animation: pulse 1s infinite; font-family: 'Orbitron'; }
        .sound-btn { background: #1a1a2e; border: 1px solid #00ff00; color: #00ff00; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.7rem; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        #map { width: 100%; height: calc(100vh - 220px); }
        .radar-panel { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(10, 20, 30, 0.98); padding: 10px; border-top: 2px solid #00ff00; z-index: 1000; }
        .radar-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
        .radar-item { background: rgba(0, 255, 0, 0.1); border: 1px solid #00ff00; border-radius: 5px; padding: 8px; text-align: center; }
        .radar-item .label { color: #00ff00; font-size: 0.55rem; text-transform: uppercase; letter-spacing: 1px; }
        .radar-item .value { color: #fff; font-size: 1rem; font-weight: bold; margin-top: 3px; text-shadow: 0 0 5px #00ff00; }
        .location-bar { display: flex; align-items: center; gap: 10px; background: rgba(0, 255, 0, 0.05); padding: 8px; border-radius: 5px; border: 1px solid #00ff00; }
        .location-bar .flag { font-size: 1.8rem; }
        .location-bar .info { flex: 1; }
        .location-bar .country { color: #00ff00; font-size: 0.9rem; font-weight: bold; }
        .location-bar .next { color: #ffd700; font-size: 0.65rem; margin-top: 2px; }
        .countdown-box { text-align: center; margin-top: 8px; }
        .countdown-box .time { font-size: 1.5rem; color: #00ff00; letter-spacing: 3px; text-shadow: 0 0 10px #00ff00; }
        .countdown-box .label { color: #87ceeb; font-size: 0.6rem; margin-top: 2px; }
        .progress-bar { width: 100%; height: 6px; background: rgba(0,255,0,0.2); border-radius: 3px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00ff00, #ffd700); transition: width 1s; }
        .snowflakes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; overflow: hidden; }
        .snowflake { position: absolute; color: white; animation: fall linear infinite; opacity: 0.6; }
        @keyframes fall { 0% { transform: translateY(-10vh) rotate(0deg); } 100% { transform: translateY(110vh) rotate(360deg); } }
        .celebration { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 2000; flex-direction: column; }
        .celebration.active { display: flex; }
        .celebration .santa { font-size: 5rem; animation: bounce 0.5s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .celebration .text { font-family: 'Mountains of Christmas', cursive; color: #ffd700; font-size: 1.8rem; margin: 15px 0; text-align: center; }
        .celebration .address { color: #87ceeb; font-size: 0.9rem; background: rgba(0,255,0,0.1); padding: 10px 20px; border-radius: 10px; border: 1px solid #00ff00; }
        .celebration .close-btn { margin-top: 15px; background: #c41e3a; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-family: 'Orbitron'; }
        .confetti { position: absolute; width: 8px; height: 8px; animation: confetti-fall 3s linear infinite; }
        @keyframes confetti-fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .config-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 3000; }
        .config-modal.active { display: flex; }
        .config-box { background: #1a1a2e; padding: 20px; border-radius: 10px; border: 2px solid #00ff00; text-align: center; max-width: 95%; }
        .config-box h2 { font-family: 'Mountains of Christmas', cursive; color: #00ff00; margin-bottom: 15px; }
        .config-box h3 { color: #ffd700; font-size: 0.8rem; margin: 12px 0 5px 0; }
        .config-box input { width: 100%; padding: 10px; font-size: 1rem; border-radius: 5px; border: 1px solid #00ff00; background: #0a0a1a; color: #00ff00; text-align: center; font-family: 'Orbitron'; }
        .config-box button { background: #00ff00; color: #0a0a1a; border: none; padding: 10px 20px; font-size: 0.9rem; border-radius: 5px; margin: 8px 5px; cursor: pointer; font-family: 'Orbitron'; font-weight: bold; }
        .config-box .hint { color: #87ceeb; font-size: 0.65rem; margin-top: 10px; }
        .leaflet-popup-content-wrapper { background: #1a1a2e; color: #00ff00; border-radius: 5px; border: 1px solid #00ff00; }
        .leaflet-popup-tip { background: #1a1a2e; }
        .scan-line { position: fixed; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #00ff00, transparent); animation: scan 3s linear infinite; z-index: 998; pointer-events: none; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
    </style>
</head>
<body>
    <div class="scan-line"></div>
    <div class="snowflakes" id="snow"></div>
    <div class="header">
        <h1 id="title">ğŸ„ SANTA RADAR ğŸ„</h1>
        <span class="live-badge">âš« LIVE TRACKING</span>
        <button class="sound-btn" id="soundBtn" onclick="toggleSound()">ğŸ”‡ SONIDO</button>
    </div>
    <div id="map"></div>
    <div class="radar-panel">
        <div class="radar-grid">
            <div class="radar-item">
                <div class="label">ğŸ“ Distancia</div>
                <div class="value" id="distance">-- km</div>
            </div>
            <div class="radar-item">
                <div class="label">âš¡ Velocidad</div>
                <div class="value" id="speed">-- km/h</div>
            </div>
            <div class="radar-item">
                <div class="label">âœˆï¸ Altitud</div>
                <div class="value" id="altitude">-- m</div>
            </div>
            <div class="radar-item">
                <div class="label">ğŸ Regalos</div>
                <div class="value" id="gifts">--</div>
            </div>
        </div>
        <div class="location-bar">
            <span class="flag" id="flag">ğŸ”ï¸</span>
            <div class="info">
                <div class="country" id="country">POLO NORTE</div>
                <div class="next" id="nextStop">â–¶ PrÃ³xima: JapÃ³n ğŸ‡¯ğŸ‡µ</div>
            </div>
        </div>
        <div class="countdown-box">
            <div class="time" id="countdown">--:--:--</div>
            <div class="label" id="countdownLabel">TIEMPO RESTANTE</div>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progress" style="width:0%"></div></div>
    </div>
    <div class="celebration" id="celebration1">
        <div class="santa">ğŸ…</div>
        <div class="text">Â¡OBJETIVO ALCANZADO!</div>
        <div class="address">ğŸ“ CASA 1 - RoldÃ¡n 234<br>ğŸ  Â¡Feliz Navidad!</div>
        <button class="close-btn" onclick="closeCel1()">â–¶ CONTINUAR TRACKING</button>
    </div>
    <div class="celebration" id="celebration2">
        <div class="santa">ğŸ…</div>
        <div class="text">Â¡MISIÃ“N COMPLETADA!</div>
        <div class="address">ğŸ“ CASA 2 - Casa de tu Hermana<br>ğŸ„ Â¡Felices Fiestas!</div>
    </div>
    <div class="config-modal" id="configModal">
        <div class="config-box">
            <h2>âš™ï¸ CONFIGURAR LLEGADAS</h2>
            <h3>ğŸ  CASA 1 - Tu Casa</h3>
            <input type="time" id="arrival1Time" value="00:00">
            <input type="date" id="arrival1Date" value="2025-12-25">
            <h3>ğŸ¡ CASA 2 - Casa Hermana</h3>
            <input type="time" id="arrival2Time" value="00:30">
            <input type="date" id="arrival2Date" value="2025-12-25">
            <br><br>
            <button onclick="saveConfig()">âœ“ GUARDAR</button>
            <button onclick="closeConfig()" style="background:#666;color:#fff;">âœ• CANCELAR</button>
            <div class="hint">Triple tap en el tÃ­tulo para abrir config</div>
        </div>
    </div>
    <audio id="bgMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const CASA1 = { lat: -27.458241856223577, lng: -58.99881432883506, nombre: "RoldÃ¡n 234" };
        const CASA2 = { lat: -27.465750, lng: -59.004528, nombre: "Casa Hermana" };
        let HORA_CASA1 = localStorage.getItem('santaCasa1') || '2025-12-25T00:00:00';
        let HORA_CASA2 = localStorage.getItem('santaCasa2') || '2025-12-25T00:30:00';
        const RUTA = [
            { lat: 90, lng: 0, nombre: "POLO NORTE", ciudad: "Taller de Santa", flag: "ğŸ”ï¸" },
            { lat: 35.6762, lng: 139.6503, nombre: "JAPÃ“N", ciudad: "Tokio", flag: "ğŸ‡¯ğŸ‡µ" },
            { lat: 37.5665, lng: 126.9780, nombre: "COREA DEL SUR", ciudad: "SeÃºl", flag: "ğŸ‡°ğŸ‡·" },
            { lat: 39.9042, lng: 116.4074, nombre: "CHINA", ciudad: "Beijing", flag: "ğŸ‡¨ğŸ‡³" },
            { lat: 13.7563, lng: 100.5018, nombre: "TAILANDIA", ciudad: "Bangkok", flag: "ğŸ‡¹ğŸ‡­" },
            { lat: -33.8688, lng: 151.2093, nombre: "AUSTRALIA", ciudad: "SÃ­dney", flag: "ğŸ‡¦ğŸ‡º" },
            { lat: 28.6139, lng: 77.2090, nombre: "INDIA", ciudad: "Nueva Delhi", flag: "ğŸ‡®ğŸ‡³" },
            { lat: 25.2048, lng: 55.2708, nombre: "EMIRATOS", ciudad: "Dubai", flag: "ğŸ‡¦ğŸ‡ª" },
            { lat: 55.7558, lng: 37.6173, nombre: "RUSIA", ciudad: "MoscÃº", flag: "ğŸ‡·ğŸ‡º" },
            { lat: 52.5200, lng: 13.4050, nombre: "ALEMANIA", ciudad: "BerlÃ­n", flag: "ğŸ‡©ğŸ‡ª" },
            { lat: 48.8566, lng: 2.3522, nombre: "FRANCIA", ciudad: "ParÃ­s", flag: "ğŸ‡«ğŸ‡·" },
            { lat: 51.5074, lng: -0.1278, nombre: "REINO UNIDO", ciudad: "Londres", flag: "ğŸ‡¬ğŸ‡§" },
            { lat: 40.4168, lng: -3.7038, nombre: "ESPAÃ‘A", ciudad: "Madrid", flag: "ğŸ‡ªğŸ‡¸" },
            { lat: 30.0444, lng: 31.2357, nombre: "EGIPTO", ciudad: "El Cairo", flag: "ğŸ‡ªğŸ‡¬" },
            { lat: 40.7128, lng: -74.0060, nombre: "USA", ciudad: "Nueva York", flag: "ğŸ‡ºğŸ‡¸" },
            { lat: 19.4326, lng: -99.1332, nombre: "MÃ‰XICO", ciudad: "CDMX", flag: "ğŸ‡²ğŸ‡½" },
            { lat: 4.7110, lng: -74.0721, nombre: "COLOMBIA", ciudad: "BogotÃ¡", flag: "ğŸ‡¨ğŸ‡´" },
            { lat: -12.0464, lng: -77.0428, nombre: "PERÃš", ciudad: "Lima", flag: "ğŸ‡µğŸ‡ª" },
            { lat: -33.4489, lng: -70.6693, nombre: "CHILE", ciudad: "Santiago", flag: "ğŸ‡¨ğŸ‡±" },
            { lat: -22.9068, lng: -43.1729, nombre: "BRASIL", ciudad: "RÃ­o", flag: "ğŸ‡§ğŸ‡·" },
            { lat: -34.6037, lng: -58.3816, nombre: "ARGENTINA", ciudad: "Buenos Aires", flag: "ğŸ‡¦ğŸ‡·" },
            { lat: -31.4201, lng: -64.1888, nombre: "ARGENTINA", ciudad: "CÃ³rdoba", flag: "ğŸ‡¦ğŸ‡·" },
            { lat: CASA1.lat, lng: CASA1.lng, nombre: "Â¡TU CASA!", ciudad: "Resistencia", flag: "ğŸ " }
        ];
        let map, santaMarker, tapCount = 0, tapTimer, soundOn = false;
        let arrivedCasa1 = false, arrivedCasa2 = false;
        for(let i = 0; i < 30; i++) {
            const s = document.createElement('div');
            s.className = 'snowflake';
            s.innerHTML = ['â„','â…','â†'][Math.floor(Math.random()*3)];
            s.style.left = Math.random()*100+'vw';
            s.style.animationDuration = (Math.random()*3+4)+'s';
            s.style.animationDelay = Math.random()*5+'s';
            s.style.fontSize = (Math.random()*10+6)+'px';
            document.getElementById('snow').appendChild(s);
        }
        function toggleSound() {
            const audio = document.getElementById('bgMusic');
            const btn = document.getElementById('soundBtn');
            if(soundOn) { audio.pause(); btn.textContent = 'ğŸ”‡ SONIDO'; soundOn = false; }
            else { audio.volume = 0.3; audio.play(); btn.textContent = 'ğŸ”Š SONIDO'; soundOn = true; }
        }
        document.getElementById('title').addEventListener('click', () => {
            tapCount++; clearTimeout(tapTimer);
            tapTimer = setTimeout(() => tapCount = 0, 500);
            if(tapCount >= 3) { tapCount = 0; openConfig(); }
        });
        function openConfig() {
            document.getElementById('configModal').classList.add('active');
            const a1 = new Date(HORA_CASA1), a2 = new Date(HORA_CASA2);
            document.getElementById('arrival1Time').value = a1.toTimeString().slice(0,5);
            document.getElementById('arrival1Date').value = a1.toISOString().slice(0,10);
            document.getElementById('arrival2Time').value = a2.toTimeString().slice(0,5);
            document.getElementById('arrival2Date').value = a2.toISOString().slice(0,10);
        }
        function saveConfig() {
            HORA_CASA1 = `${document.getElementById('arrival1Date').value}T${document.getElementById('arrival1Time').value}:00`;
            HORA_CASA2 = `${document.getElementById('arrival2Date').value}T${document.getElementById('arrival2Time').value}:00`;
            localStorage.setItem('santaCasa1', HORA_CASA1);
            localStorage.setItem('santaCasa2', HORA_CASA2);
            document.getElementById('configModal').classList.remove('active');
            arrivedCasa1 = arrivedCasa2 = false;
        }
        function closeConfig() { document.getElementById('configModal').classList.remove('active'); }
        function closeCel1() { document.getElementById('celebration1').classList.remove('active'); }
        function haversine(lat1,lon1,lat2,lon2) {
            const R = 6371, dLat = (lat2-lat1)*Math.PI/180, dLon = (lon2-lon1)*Math.PI/180;
            const a = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
        map = L.map('map', { zoomControl: false, attributionControl: false }).setView([20, 0], 2);
        L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
        L.marker([CASA1.lat, CASA1.lng], { icon: L.divIcon({ className: '', html: '<div style="font-size:1.5rem;filter:drop-shadow(0 0 5px #00ff00)">ğŸ </div>', iconSize: [25,25], iconAnchor: [12,25] }) }).addTo(map);
        L.marker([CASA2.lat, CASA2.lng], { icon: L.divIcon({ className: '', html: '<div style="font-size:1.5rem;filter:drop-shadow(0 0 5px #ffd700)">ğŸ¡</div>', iconSize: [25,25], iconAnchor: [12,25] }) }).addTo(map);
        santaMarker = L.marker([90, 0], { icon: L.divIcon({ className: '', html: '<div style="font-size:1.1rem;background:rgba(0,0,0,0.7);padding:3px 6px;border-radius:5px;border:1px solid #00ff00;white-space:nowrap;filter:drop-shadow(0 0 5px #00ff00)">ğŸ¦ŒğŸ¦ŒğŸ›·ğŸ…ğŸ</div>', iconSize: [85,30], iconAnchor: [42,15] }), zIndexOffset: 1000 }).addTo(map);
        RUTA.forEach((r, i) => { if(i > 0 && i < RUTA.length - 1) L.marker([r.lat, r.lng], { icon: L.divIcon({ className: '', html: `<div style="font-size:1rem;opacity:0.7">${r.flag}</div>`, iconSize: [18,18], iconAnchor: [9,9] }) }).addTo(map); });
        let lastZoom = 0;
        function update() {
            const now = new Date(), arr1 = new Date(HORA_CASA1), arr2 = new Date(HORA_CASA2);
            if(now < arr1) {
                const dur = 24*60*60*1000, start = new Date(arr1.getTime() - dur);
                const prog = Math.max(0, Math.min(1, (now - start) / dur));
                const stops = RUTA.length - 1, exact = prog * stops;
                const idx = Math.min(Math.floor(exact), stops - 1), frac = exact - idx;
                const from = RUTA[idx], to = RUTA[Math.min(idx + 1, stops)];
                const lat = from.lat + (to.lat - from.lat) * frac;
                const lng = from.lng + (to.lng - from.lng) * frac;
                santaMarker.setLatLng([lat, lng]);
                const distToCasa = haversine(lat, lng, CASA1.lat, CASA1.lng);
                const speed = 3000 + Math.random() * 500;
                const alt = 10000 + Math.random() * 2000;
                const gifts = Math.floor(7000000000 * (1 - prog));
                document.getElementById('distance').textContent = distToCasa.toFixed(0) + ' km';
                document.getElementById('speed').textContent = speed.toFixed(0) + ' km/h';
                document.getElementById('altitude').textContent = alt.toFixed(0) + ' m';
                document.getElementById('gifts').textContent = gifts.toLocaleString();
                document.getElementById('flag').textContent = from.flag;
                document.getElementById('country').textContent = from.nombre;
                document.getElementById('nextStop').textContent = to ? `â–¶ PrÃ³xima: ${to.ciudad} ${to.flag}` : '';
                document.getElementById('progress').style.width = (prog * 100) + '%';
                const rem = arr1 - now;
                const h = Math.floor(rem / 3600000), m = Math.floor((rem % 3600000) / 60000), s = Math.floor((rem % 60000) / 1000);
                document.getElementById('countdown').textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                document.getElementById('countdownLabel').textContent = 'TIEMPO PARA CASA 1';
                if(Date.now() - lastZoom > 30000) { lastZoom = Date.now(); map.flyTo([lat, lng], rem < 3600000 ? 6 : 3, { duration: 2 }); }
            } else if(now >= arr1 && now < arr2) {
                if(!arrivedCasa1) { arrivedCasa1 = true; showCel(1); }
                const prog = Math.min(1, (now - arr1) / (arr2 - arr1));
                const lat = CASA1.lat + (CASA2.lat - CASA1.lat) * prog;
                const lng = CASA1.lng + (CASA2.lng - CASA1.lng) * prog;
                santaMarker.setLatLng([lat, lng]);
                document.getElementById('distance').textContent = haversine(lat, lng, CASA2.lat, CASA2.lng).toFixed(1) + ' km';
                document.getElementById('speed').textContent = '50 km/h';
                document.getElementById('altitude').textContent = '100 m';
                document.getElementById('flag').textContent = 'ğŸ¦Œ';
                document.getElementById('country').textContent = 'EN CAMINO';
                document.getElementById('nextStop').textContent = 'â–¶ Casa 2 ğŸ¡';
                document.getElementById('progress').style.width = (prog * 100) + '%';
                const rem = arr2 - now;
                const m = Math.floor(rem / 60000), s = Math.floor((rem % 60000) / 1000);
                document.getElementById('countdown').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                document.getElementById('countdownLabel').textContent = 'TIEMPO PARA CASA 2';
                if(Date.now() - lastZoom > 10000) { lastZoom = Date.now(); map.flyToBounds([[CASA1.lat, CASA1.lng], [CASA2.lat, CASA2.lng]], { padding: [50,50], maxZoom: 15, duration: 2 }); }
            } else {
                if(!arrivedCasa2) { arrivedCasa2 = true; santaMarker.setLatLng([CASA2.lat, CASA2.lng]); document.getElementById('celebration1').classList.remove('active'); showCel(2); map.flyTo([CASA2.lat, CASA2.lng], 17, { duration: 2 }); }
                document.getElementById('distance').textContent = '0 km';
                document.getElementById('speed').textContent = '0 km/h';
                document.getElementById('altitude').textContent = '0 m';
                document.getElementById('gifts').textContent = 'ğŸ';
                document.getElementById('flag').textContent = 'ğŸ…';
                document.getElementById('country').textContent = 'Â¡LLEGÃ“!';
                document.getElementById('nextStop').textContent = 'âœ“ MisiÃ³n completada';
                document.getElementById('countdown').textContent = 'ğŸ„ğŸğŸ„';
                document.getElementById('countdownLabel').textContent = 'Â¡FELIZ NAVIDAD!';
                document.getElementById('progress').style.width = '100%';
            }
        }
        function showCel(n) {
            const cel = document.getElementById('celebration' + n);
            cel.classList.add('active');
            const colors = ['#ff0000','#00ff00','#ffd700','#ff69b4','#00ffff'];
            for(let i = 0; i < 50; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random()*100+'vw';
                c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                c.style.animationDelay = Math.random()*3+'s';
                cel.appendChild(c);
            }
        }
        update();
        setInterval(update, 1000);
    </script>
</body>
</html>
